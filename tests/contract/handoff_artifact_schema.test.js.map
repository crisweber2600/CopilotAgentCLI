{"version":3,"file":"handoff_artifact_schema.test.js","sourceRoot":"","sources":["handoff_artifact_schema.test.ts"],"names":[],"mappings":";;;;;AAAA,mCAA8C;AAC9C,qCAAuC;AACvC,yCAAoC;AACpC,8CAAsB;AAEtB,MAAM,UAAU,GAAG,IAAA,mBAAO,EACxB,SAAS,EACT,IAAI,EACJ,IAAI,EACJ,OAAO,EACP,yBAAyB,EACzB,WAAW,EACX,8BAA8B,CAC/B,CAAC;AAEF,MAAM,UAAU,GAAG,IAAA,mBAAO,EACxB,SAAS,EACT,IAAI,EACJ,IAAI,EACJ,WAAW,EACX,SAAS,EACT,6FAA6F,CAC9F,CAAC;AAEF,IAAA,iBAAQ,EAAC,yBAAyB,EAAE,GAAG,EAAE;IACvC,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAA,sBAAY,EAAC,UAAU,EAAE,OAAO,CAAC,CAAC,CAAC;IAC7D,MAAM,GAAG,GAAG,IAAI,aAAG,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,CAAC;IACxD,MAAM,QAAQ,GAAG,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;IAErC,IAAA,WAAE,EAAC,8BAA8B,EAAE,GAAG,EAAE;QACtC,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,IAAA,sBAAY,EAAC,UAAU,EAAE,OAAO,CAAC,CAAC,CAAC;QAC/D,MAAM,KAAK,GAAG,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACjC,IAAA,eAAM,EAAC,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACrE,CAAC,CAAC,CAAC;IAEH,IAAA,WAAE,EAAC,iCAAiC,EAAE,GAAG,EAAE;QACzC,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,IAAA,sBAAY,EAAC,UAAU,EAAE,OAAO,CAAC,CAAC,CAAC;QAC/D,OAAO,QAAQ,CAAC,KAAK,CAAC;QACtB,MAAM,KAAK,GAAG,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACjC,IAAA,eAAM,EAAC,KAAK,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC1B,MAAM,QAAQ,GAAG,QAAQ,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;QACtE,IAAA,eAAM,EAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,EAAE,QAAQ,CAAC,2BAA2B,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAChG,CAAC,CAAC,CAAC;IAEH,IAAA,WAAE,EAAC,6BAA6B,EAAE,GAAG,EAAE;QACrC,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,IAAA,sBAAY,EAAC,UAAU,EAAE,OAAO,CAAC,CAAC,CAAC;QAC/D,QAAQ,CAAC,SAAS,GAAG,eAAe,CAAC;QACrC,MAAM,KAAK,GAAG,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACjC,IAAA,eAAM,EAAC,KAAK,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC1B,MAAM,QAAQ,GAAG,QAAQ,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;QACtE,IAAA,eAAM,EAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,gBAAgB,CAAC,IAAI,CAAC,OAAO,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACtF,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["import { describe, expect, it } from 'vitest';\nimport { readFileSync } from 'node:fs';\nimport { resolve } from 'node:path';\nimport Ajv from 'ajv';\n\nconst schemaPath = resolve(\n  __dirname,\n  '..',\n  '..',\n  'specs',\n  '001-create-a-structured',\n  'contracts',\n  'handoff-artifact.schema.json',\n);\n\nconst samplePath = resolve(\n  __dirname,\n  '..',\n  '..',\n  'artifacts',\n  'handoff',\n  '2025-09-19T15-45-00Z-work-item-001-create-a-structured-phase-setup-attempt-phase-setup.json',\n);\n\ndescribe('handoff artifact schema', () => {\n  const schema = JSON.parse(readFileSync(schemaPath, 'utf-8'));\n  const ajv = new Ajv({ allErrors: true, strict: false });\n  const validate = ajv.compile(schema);\n\n  it('accepts a compliant artifact', () => {\n    const artifact = JSON.parse(readFileSync(samplePath, 'utf-8'));\n    const valid = validate(artifact);\n    expect(valid, JSON.stringify(validate.errors, null, 2)).toBe(true);\n  });\n\n  it('rejects missing required fields', () => {\n    const artifact = JSON.parse(readFileSync(samplePath, 'utf-8'));\n    delete artifact.actor;\n    const valid = validate(artifact);\n    expect(valid).toBe(false);\n    const messages = validate.errors?.map((error) => error.message) ?? [];\n    expect(messages.some((message) => message?.includes(\"required property 'actor'\"))).toBe(true);\n  });\n\n  it('rejects invalid enum values', () => {\n    const artifact = JSON.parse(readFileSync(samplePath, 'utf-8'));\n    artifact.eventType = 'invalid-event';\n    const valid = validate(artifact);\n    expect(valid).toBe(false);\n    const messages = validate.errors?.map((error) => error.message) ?? [];\n    expect(messages.some((message) => /allowed values/.test(message ?? ''))).toBe(true);\n  });\n});\n"]}